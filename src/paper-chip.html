<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="klog-icons.html">
<link rel="import" href="klog-style.html">
<dom-module id="paper-chip">
  <template>
    <style>
      :host {
        display: inline-block;
        user-select: none;
        -webkit-user-select: none;
        cursor: default;
        outline: none;
      }

      .container {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        max-width: 100%;
      }

      iron-icon {
        height: var(--paper-chip-icon-size, 24px);
        width: var(--paper-chip-icon-size, 24px);
        flex-shrink: 0;
      }

      :host([label]) iron-icon {
        margin-right: 4px;
      }

      .checkmark {
        width: 0;
        height: 20px;
        vertical-align: middle;
        color: var(--primary-text-color);
        -webkit-transition: width .15s cubic-bezier(.4, 0, .2, 1);
        -o-transition: width .15s cubic-bezier(.4, 0, .2, 1);
        transition: width .15s cubic-bezier(.4, 0, .2, 1);
      }

      :host([active]) .checkmark {
        width: 20px;
      }

      .checkmark path {
        -webkit-transition: stroke-dashoffset .15s cubic-bezier(.4, 0, .6, 1) 50ms;
        -o-transition: stroke-dashoffset .15s 50ms cubic-bezier(.4, 0, .6, 1);
        transition: stroke-dashoffset .15s cubic-bezier(.4, 0, .6, 1) 50ms;
        stroke-width: 2px;
        stroke-dashoffset: 29.78334;
        stroke-dasharray: 29.78334;
        stroke: var(--paper-chip-text-color, --primary-text-color);
      }

      :host([active]) .checkmark path {
        stroke-dashoffset: 0;
        stroke: var(--primary-color);
      }

      .checkmark[hidden] {
        display: none;
      }

      :host .expand-container {
        overflow: hidden;
        width: 0px;
        transition: width .15s cubic-bezier(.4, 0, .6, 1) 50ms;
      }

      :host([active]) .expand-container {
        width: var(--paper-chip-expand-width, 0px);
      }

      paper-button {
        padding: 6px 16px;
        font-size: 14px;
        margin: 0;
        min-width: auto;
        border-radius: 20px;
        color: var(--paper-chip-text-color, --primary-text-color);
        overflow: hidden;
        text-transform: none;
        background: transparent;
        width: 100%;
        outline: none;
        @apply --paper-chip-style;
      }

      paper-button::after {
        @apply --overlay-style;
      }

      :host([disabled]) paper-button {
        color: var(--disabled-text-color);
      }

      :host([active]) paper-button {
        color: var(--primary-color);
      }

      :host([active]) paper-button::after {
        @apply --overlay-style-selected;
      }

      :host([outlined]) paper-button {
        border: var(--outlined-border-width) solid var(--border-color, --divider-color);
      }

      :host([outlined]) paper-button::after {
        opacity: 0;
      }

      :host([outlined][active]) paper-button {
        border: var(--outlined-border-width) solid var(--primary-color);
      }
    </style>

    <paper-button disabled="{{disabled}}">
      <svg class="checkmark" hidden$="{{checkmarkAnimationDisabled}}" viewBox="-2 -3 30 30">
        <path fill="none" stroke="black" d="M1.73,12.91 8.1,19.28 22.79,4.59"></path>
      </svg>
      <template is="dom-if" if="{{icon}}">
        <iron-icon icon="{{icon}}"></iron-icon>
      </template>
      </iron-icon>
      <div class="container">
        {{label}}
        <slot></slot>
      </div>
      <div class="expand-container">
        <slot name="expand-content"></slot>
      </div>
    </paper-button>

  </template>

  <script>
    class PaperChip extends Polymer.Element {

      static get is() { return 'paper-chip'; }

      static get properties() {
        return {
          active: {
            type: Boolean,
            reflectToAttribute: true
          },
          disabled: {
            type: Boolean,
            reflectToAttribute: true
          },
          checkmarkAnimationDisabled: {
            type: Boolean,
            value: false
          },
          icon: {
            type: String
          },
          label: {
            type: String,
            reflectToAttribute: true
          },
          href: {
            type: String
          },
        }
      }

      ready() {
        super.ready();
        this.addEventListener('click', e => {
          if (this.href) {
            e.stopPropagation();
            e.preventDefault();
            window.open(this.href);
          }
        });
      }

    }

    window.customElements.define(PaperChip.is, PaperChip);
  </script>

</dom-module>