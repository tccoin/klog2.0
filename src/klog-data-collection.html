<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="klog-data-gql.html">
<dom-module id="klog-data-collection">
  <script>
    class klogDataCollection extends Polymer.Element {
      static get is() { return 'klog-data-collection'; }

      static get properties() {
        return {
          lastResponse: {
            type: Array,
            notify: true
          }
        }
      }

      list() {
        let query = new AV.Query('Article');
        query.select(['collection']);
        if (!this.userinfo || !this.userinfo.publicinfo) {
          setTimeout(() => this.list(), 100);
          return;
        }
        let author = AV.Object.createWithoutData('UserPublic', this.userinfo.publicinfo.id);
        query.equalTo('author', author);
        query.ascending('createdAt');
        query.limit(1000);
        return query.find()
          .then(articles => {
            let collections = new Set(['笔记', '日常', '项目']);
            for (let article of articles) {
              if (article.get('collection')) {
                collections.add(article.get('collection'));
              }
            }
            return this.lastResponse = Array.from(collections);
          });
      }
    }
    window.customElements.define(klogDataCollection.is, klogDataCollection);
  </script>
</dom-module>