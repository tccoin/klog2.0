<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="klog-icons.html">
<dom-module id="klog-menu">
  <template>
    <style include="klog-style-scrollbar"></style>
    <style>
      :host {
        display: block;
        color: var(--primary-text-color);
      }

      iron-selector>.divider {
        margin: 8px 0;
        border-top: 1px solid var(--divider-color);
      }

      .subtitle {
        display: flex;
        align-items: center;
        height: 24px;
        font-size: .9em;
        padding: 16px 16px 8px;
        overflow: hidden;
        position: relative;
      }

      .subtitle.button {
        padding: 16px;
      }

      .subtitle>.divider {
        width: 16px;
      }

      .label-item-container {
        overflow: hidden;
        transition: all .2s ease;
      }

      :host([collapsed]) .label-item-container {
        height: 0 !important;
      }

      .subtitle.button .collapsed-icon {
        transform: rotate(0);
        transition: all .2s ease;
      }

      :host([collapsed]) .subtitle.button .collapsed-icon {
        transform: rotate(90deg);
      }

      .item {
        position: relative;
        line-height: 32px;
        padding: 6px 8px;
        margin: 4px 8px;
        border-radius: 5px;
        box-sizing: border-box;
        overflow: hidden;
        font-size: 14px;
        cursor: pointer;
        user-select: none;
        white-space: nowrap;
        -webkit-user-select: none;
        -webkit-tap-highlight-color: transparent;
      }

      :host([round]) .item {
        padding: 4px 12px;
        margin: 4px 8px 0px 0;
        border-radius: 0 22px 22px 0;
      }

      .item span {
        user-select: none;
        -webkit-user-select: none;
      }

      .item iron-icon {
        margin-right: 16px;
      }

      .item::after {
        @apply --overlay-style;
        opacity: 0;
      }

      .item:not(.iron-selected):hover::after {
        opacity: var(--secondary-overlay-opacity);
      }

      .item.iron-selected {
        font-weight: bolder;
        color: var(--primary-color);
        cursor: default;
      }

      .item.iron-selected::after {
        opacity: var(--secondary-overlay-opacity);
        background-color: var(--primary-color);
      }

      .item.secondary iron-icon {
        opacity: 0.6;
      }
    </style>
    <iron-selector attr-for-selected="name" id="selector" selected="{{page}}" on-iron-select="updatePage">

      <div class="item" name="timeline">
        <iron-icon icon="timeline"></iron-icon>
        <span>时间轴</span>
        <paper-ripple></paper-ripple>
      </div>

      <div class="item" name="note/all/">
        <iron-icon icon="book"></iron-icon>
        <span>笔记本</span>
        <paper-ripple></paper-ripple>
      </div>

      <template is="dom-if" if="{{login}}">

        <div class="item" name="userpanel">
          <iron-icon icon="account_circle"></iron-icon>
          <span>个人设置</span>
          <paper-ripple></paper-ripple>
        </div>
      </template>

      <div class="item" on-click="about">
        <iron-icon icon="console"></iron-icon>
        <span>控制台</span>
        <paper-ripple></paper-ripple>
      </div>

      <template is="dom-if" if="{{!login}}">
        <div class="divider"></div>
        <div class="subtitle"><span>账户</span></div>
        <div class="item" name="login">
          <iron-icon icon="account_circle"></iron-icon>
          <span>登录</span>
          <paper-ripple></paper-ripple>
        </div>
        <div class="item" name="signup">
          <iron-icon icon="account_box"></iron-icon>
          <span>注册</span>
          <paper-ripple></paper-ripple>
        </div>
      </template>

    </iron-selector>
    <iron-selector attr-for-selected="name" selected="{{collection}}" on-iron-select="updateCollection">
      <template is="dom-if" if="{{login}}">
        <template is="dom-if" if="{{!_isEmpty(collections)}}">

          <div class="divider"></div>
          <div class="subtitle"><span>分类</span></div>

          <template is="dom-repeat" items="{{collections}}">
            <div class="item secondary" name$="{{item}}">
              <iron-icon icon="label"></iron-icon>
              <span>{{item}}</span>
              <paper-ripple></paper-ripple>
            </div>
          </template>

        </template>

      </template>
    </iron-selector>

  </template>
  <script>
    class KlogMenu extends Polymer.Element {

      static get is() { return 'klog-menu'; }

      static get properties() {
        return {
          page: {
            type: String
          },
          login: {
            type: Boolean,
            value: false
          }
        }
      }

      updatePage(e) {
        const name = e.detail.item.getAttribute('name');
        if (name) {
          this.dispatchEvent(new CustomEvent('app-load', {
            bubbles: true,
            composed: true,
            detail: { page: name }
          }));
          this.dispatchEvent(new CustomEvent('menu-select', {
            bubbles: true,
            composed: true,
          }));
        }
      }

      updateCollection(e) {
        const collection = e.detail.item.getAttribute('name');
        if (collection) {
          this.dispatchEvent(new CustomEvent('collection-select', {
            bubbles: true,
            composed: true,
            detail: { collection: collection }
          }));
        }
      }

      _isEmpty(array) {
        return array ? array.length == 0 : true;
      }

      about() {
        this.dispatchEvent(new CustomEvent('menu-select', {
          bubbles: true,
          composed: true,
        }));
        this.dispatchEvent(new CustomEvent('open-about', {
          bubbles: true,
          composed: true,
        }));
      }

    }

    window.customElements.define(KlogMenu.is, KlogMenu);
  </script>
</dom-module>